<main role="main" class="cv-main-content discover-page -rel">

  <section class="profile-voices-intro">
      <h1 class="profile-heading -inline-block -font-bold -m0">Trending</h1>
      <div class="profile-select-options -inline-block">

      </div>

      <article role="article" class="profile-menu -row -rel">
        <div class="profile-tabs">
          <div class="menu-item active -menu-tab -inline-block">
            <p class="-font-bold">Popular Voices</p>
          </div>
          <div class="menu-item -menu-tab -inline-block">
            <p class="-font-bold">Most Updated Voices</p>
          </div>
          <div class="menu-item -menu-tab -inline-block">
            <p class="-font-bold">Popular Users</p>
          </div>
          <div class="menu-item -menu-tab -inline-block">
            <p class="-font-bold">Popular Organizations</p>
          </div>

        </div>

      </article>

  </section>

  <section class="profile-body profile-menu-content -rel">


    <div class="active -menu-tab-content">
      <div class="-row discover-voices-container">
        <!-- voices -->
      </div>
    </div>

    <div class="-menu-tab-content">
      <div class="-row discover-updated-container">
        <!-- updated voices -->
      </div>
    </div>

    <div class="-menu-tab-content">
    	<div class="-row discover-people-container">
        	<!-- people -->
      	</div>
    </div>

    <div class="-menu-tab-content">
    	<div class="-row discover-organizations-container">
        	<!-- organizations -->
      	</div>
    </div>


  </section>

</main>

<script>

	// App
	var ns = [];
	<% if (typeof notifications !== "undefined") { %>
		ns = <%= JSON.stringify(notifications) %>;
	<% } %>
		var App = new CV.App({
		notifications : ns,
		currentPerson : currentPerson
	});
	App.addInteractiveSidebar();

	var responsives = {
    	'voices' 		: null,
    	'people' 		: null,
    	'organizations' : null,
    	'updated' 		: null
    }

	function renderData(data, instance, className){

		//data.forEach(function (item, index) {
		//  var itemEl = $('<div class="-col-4 -pr1"></div>');
		//  new instance(item).render( itemEl);
		//  $('.discover-' + className + '-container').append(itemEl);
		//});

		var itemsWrapper = document.querySelector('.discover-' + className + '-container');
        var itemsElements = [];

        data.forEach(function(item, index) {
          var itemWidget = new instance({data: item}).render(itemsWrapper);
			itemWidget.element.addClass('id-' + item.id);

            itemsElements.push(itemWidget.el);
        });

        responsives[className] = new CV.ResponsiveWidth({
            container : itemsWrapper,
            items : [].slice.call(itemsElements, 0),
            minWidth : 300
        }).setup();
	}

	function getData(url, instance, className){
		$.ajax({
			type: "GET",
			url: url,
			headers: { 'csrf-token': $('meta[name="csrf-token"]').attr('content') },
			data : {},
			dataType : 'json',
			success: function(data) {
				console.log('New '+ className);
			  	console.log(data);
			  	renderData(data, instance, className)
			}
		});
	}

  getData('/discover/trending/voices', CV.VoiceCover, 'voices');
	getData('/discover/trending/people', CV.Card, 'people');
	getData('/discover/trending/organizations', CV.Card, 'organizations');
	getData('/discover/trending/updatedVoices', CV.VoiceCover, 'updated');


	//$.ajax({
	//	type: "GET",
	//	url:'/discover/new/voices',
	//	headers: { 'csrf-token': $('meta[name="csrf-token"]').attr('content') },
	//	data : {},
	//	dataType : 'json',
	//	success: function(data) {
	//		console.log('New voices');
	//	  	console.log(data);
	//	  	//renderVoices(data);
	//	  	renderData(data, VoiceCover, 'voices')
	//	}
	//});

	//$.ajax({
	//	type: "GET",
	//	url:'/discover/new/people',
	//	headers: { 'csrf-token': $('meta[name="csrf-token"]').attr('content') },
	//	data : {},
	//	dataType : 'json',
	//	success: function(data) {
	//		console.log('New people');
	//	  	console.log(data);
	//	  	//renderPeople(data);
	//	  	renderData(data, CV.Card, 'people');
	//	}
	//});
//
	//$.ajax({
	//	type: "GET",
	//	url:'/discover/new/organizations',
	//	headers: { 'csrf-token': $('meta[name="csrf-token"]').attr('content') },
	//	data : {},
	//	dataType : 'json',
	//	success: function(data) {
	//		console.log('New organizations');
	//	  	console.log(data);
	//	  	renderData(data, CV.Card, 'organizations');
	//	}
	//});

	// **************************
	// ****** render voices *****
	// **************************
	//function renderVoices(data){
	//	data.forEach(function (voice, index) {
	//	  var voiceEl = $('<div class="-col-4 -pr1"></div>');
	//	  new VoiceCover(voice).render( voiceEl);
	//	  $('.discover-voices-container').append(voiceEl);
	//	});
	//}

	// *****************************
	// ****** render followers *****
	// *****************************
	//function renderPeople(data){
	//	data.forEach(function (person, index) {
	//	  var personEl = $('<div class="-col-4 -pr1"></div>');
	//	  new CV.Card(person).render( personEl);
	//	  $('.discover-people-container').append(personEl);
	//	});
	//}



  $( document ).ready(function() {

    createMenuActions('.profile-menu', '.profile-menu-content');

    function createMenuActions(menuContainer, contentContainer){
      $( menuContainer ).find('.-menu-tab').each(function( index ) {
        var elContent = $( contentContainer + ' .-menu-tab-content:nth-child(' + (index + 1) + ')');
        $(this).on('click', createCallback(this, index, elContent, menuContainer, contentContainer));
      });
    }

    function createCallback( tab, index, elContent, menuContainer, contentContainer ){
      return function(){
        $(menuContainer + ' .-menu-tab').removeClass('active');
        $(this).addClass('active');
        $(contentContainer + ' .-menu-tab-content').removeClass('active');
        $(elContent).addClass('active');
        responsives['voices'].setup();
        responsives['people'].setup();
        responsives['organizations'].setup();
        responsives['updated'].setup();
      }
    }


  });



</script>





