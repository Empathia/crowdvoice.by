<main role="main" class="cv-main-content -rel -row">
  <div class="-col-9 -pr2">
    <div class="page-heading cv-items-list">
      <h1 class="page-heading__title -mt0 -inline-block">My Feed</h1>
      <div class="feed__account-dropdown -ml1 profile-select-options -inline-block"></div>
    </div>
    <div class="profile-body -rel"></div>
  </div>

  <div class="-col-3 -pl2" data-feed-sidebar>
    <div class="feed__top-voices-title page-heading cv-items-list">
      <h3 class="profile-heading -inline-block -font-bold -m0">Top Voices</h3>
    </div>
    <div class="profile-sidebar -rel -pt2">
      <div class="feed__top-voices-list -pb2"></div>
      <a class="ui-btn -primary -md -block -mb2 -text-center" href="/discover/trending">Discover More</a>
    </div>
  </div>
</main>

<script>
  var App = new CV.App().addInteractiveSidebar();
  var Feed = new CV.Views.Feed({
    el: document.querySelector('.cv-main-content'),
    feedItems: <%= JSON.stringify(feed) %>
  });

  var currentOrganization;
  <% if (typeof organization !== "undefined") { %>
    currentOrganization = <%= JSON.stringify(organization) %>;
  <% } %>

  // if person has owned organizations => render dropdown
  if (
    currentPerson.ownedOrganizations != null &&
    currentPerson.ownedOrganizations.length > 0
  ) {
    if (currentOrganization) {
      var feedOptions = {
        "1": {
          label: currentPerson.name+"\'s feed",
          name: currentPerson.profileName
        }
      };

      currentPerson.ownedOrganizations.forEach(function(org, index){
        var isActive = false;
        if(currentOrganization.id == org.id){
          isActive = true;
        }
        feedOptions[index+2] = {
          label: org.name+"\'s feed",
          name: org.profileName,
          active : isActive
        };
      });
    } else {
      var feedOptions = {
        "1": {
          label: currentPerson.name+"\'s feed",
          name: currentPerson.profileName,
          active : true
        }
      };

      currentPerson.ownedOrganizations.forEach(function(org, index){
        feedOptions[index+2] = {
          label: org.name+"\'s feed",
          name: org.profileName
        };
      });
    }

    var feedSelect = new CV.Select({
      style : 'tiny',
      label : 'All feeds',
      name  : 'feedSelect',
      options: feedOptions
    }).render($('.profile-select-options'));

    for (feed in feedOptions){
      feedSelect[feedOptions[feed].name].on('click', function(){
        window.location = '/' + $(this).attr('name') + '/feed';
      });
    }
  }
</script>
